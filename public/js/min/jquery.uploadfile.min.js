!function(e){void 0==e.fn.ajaxForm&&e.getScript("http://malsup.github.io/jquery.form.js");var t={};t.fileapi=void 0!==e("<input type='file'/>").get(0).files,t.formdata=void 0!==window.FormData,e.fn.uploadFile=function(r){function o(){f.afterUploadAll&&!v&&(v=!0,function e(){0!=h.sCounter&&h.sCounter+h.fCounter==h.tCounter?(f.afterUploadAll(h),v=!1):window.setTimeout(e,100)}())}function a(t,r,o){o.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),e(this).css("border","2px solid #A5A5C7")}),o.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),o.on("drop",function(o){e(this).css("border","2px dotted #A5A5C7"),o.preventDefault(),t.errorLog.html("");var a=o.originalEvent.dataTransfer.files;return!r.multiple&&a.length>1?void(r.showError&&e("<div style='color:red;'>"+r.multiDragErrorStr+"</div>").appendTo(t.errorLog)):void(0!=r.onSelect(a)&&n(r,t,a))}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),o.css("border","2px dotted #A5A5C7")}),e(document).on("drop",function(e){e.stopPropagation(),e.preventDefault(),o.css("border","2px dotted #A5A5C7")})}function i(e){var t="",r=e/1024;if(parseInt(r)>1024){var o=r/1024;t=o.toFixed(2)+" MB"}else t=r.toFixed(2)+" KB";return t}function s(t){var r=[];r="string"==jQuery.type(t)?t.split("&"):e.param(t).split("&");var o,a,i=r.length,s=[];for(o=0;i>o;o++)r[o]=r[o].replace(/\+/g," "),a=r[o].split("="),s.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])]);return s}function n(t,r,o){for(var a=0;a<o.length;a++)if(l(r,t,o[a].name))if(-1!=t.maxFileSize&&o[a].size>t.maxFileSize)t.showError&&e("<div style='color:red;'><b>"+o[a].name+"</b> "+t.sizeErrorStr+i(t.maxFileSize)+"</div>").appendTo(r.errorLog);else{var n=t,d=new FormData,f=t.fileName.replace("[]","");d.append(f,o[a]);var c=t.formData;if(c)for(var h=s(c),m=0;m<h.length;m++)h[m]&&d.append(h[m][0],h[m][1]);n.fileData=d;var v=new p(r,t),b="";b=t.showFileCounter?r.fileCounter+t.fileCounterStyle+o[a].name:o[a].name,v.filename.html(b);var g=e("<form style='display:block; position:absolute;left: 150px;' class='"+r.formGroup+"' method='"+t.method+"' action='"+t.url+"' enctype='"+t.enctype+"'></form>");g.appendTo("body");var w=[];w.push(o[a].name),u(g,n,v,w,r),r.fileCounter++}else t.showError&&e("<div style='color:red;'><b>"+o[a].name+"</b> "+t.extErrorStr+t.allowedTypes+"</div>").appendTo(r.errorLog)}function l(e,t,r){var o=t.allowedTypes.toLowerCase().split(","),a=r.split(".").pop().toLowerCase();return"*"!=t.allowedTypes&&jQuery.inArray(a,o)<0?!1:!0}function d(r,o,a,i){var s="ajax-upload-id-"+(new Date).getTime(),f=e("<form method='"+a.method+"' action='"+a.url+"' enctype='"+a.enctype+"'></form>"),c="<input type='file' id='"+s+"' name='"+a.fileName+"'/>";a.multiple&&(a.fileName.indexOf("[]")!=a.fileName.length-2&&(a.fileName+="[]"),c="<input type='file' id='"+s+"' name='"+a.fileName+"' multiple/>");var h=e(c).appendTo(f);h.change(function(){r.errorLog.html("");var s=(a.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(b=0;b<this.files.length;b++)s.push(this.files[b].name);if(0==a.onSelect(this.files))return}else{var c=e(this).val(),h=[];if(s.push(c),!l(r,a,c))return void(a.showError&&e("<div style='color:red;'><b>"+c+"</b> "+a.extErrorStr+a.allowedTypes+"</div>").appendTo(r.errorLog));if(h.push({name:c,size:"NA"}),0==a.onSelect(h))return}if(i.unbind("click"),f.hide(),d(r,o,a,i),f.addClass(o),t.fileapi&&t.formdata){f.removeClass(o);var m=this.files;n(a,r,m)}else{for(var v="",b=0;b<s.length;b++)v+=a.showFileCounter?r.fileCounter+a.fileCounterStyle+s[b]+"<br>":s[b]+"<br>",r.fileCounter++;var g=new p(r,a);g.filename.html(v),u(f,a,g,s,r)}}),f.css({margin:0,padding:0});var m=e(i).width()+10;10==m&&(m=120);var v=i.height()+10;10==v&&(v=35),i.css({position:"relative",overflow:"hidden",cursor:"default"}),h.css({position:"absolute",cursor:"pointer",top:"0px",width:m,height:v,left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),f.appendTo(i)}function p(t,r){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>"),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar "+t.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+t.formGroup+"'>"+r.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red'>"+r.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>"+r.doneStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='ajax-file-upload-red'>"+r.deletelStr+"</div>").appendTo(this.statusbar).hide(),t.errorLog.after(this.statusbar),this}function u(e,r,a,i,n){var l={cache:!1,contentType:!1,processData:!1,forceSync:!1,data:r.formData,formData:r.fileData,dataType:r.returnType,beforeSubmit:function(t,l,d){if(0!=r.onSubmit.call(this,i)){var p=r.dynamicFormData();if(p){var u=s(p);if(u)for(var f=0;f<u.length;f++)u[f]&&(void 0!=r.fileData?d.formData.append(u[f][0],u[f][1]):d.data[u[f][0]]=u[f][1])}return n.tCounter+=i.length,o(),!0}return a.statusbar.append("<div style='color:red;'>"+r.uploadErrorStr+"</div>"),a.cancel.show(),e.remove(),a.cancel.click(function(){a.statusbar.remove()}),!1},beforeSend:function(e){a.progressDiv.show(),a.cancel.hide(),a.done.hide(),r.showAbort&&(a.abort.show(),a.abort.click(function(){e.abort()})),a.progressbar.width(t.formdata?"1%":"5%")},uploadProgress:function(e,t,o,i){i>98&&(i=98);var s=i+"%";i>1&&a.progressbar.width(s),r.showProgress&&(a.progressbar.html(s),a.progressbar.css("text-align","center"))},success:function(t,o,s){n.responses.push(t),a.progressbar.width("100%"),r.showProgress&&(a.progressbar.html("100%"),a.progressbar.css("text-align","center")),a.abort.hide(),r.onSuccess.call(this,i,t,s),r.showStatusAfterSuccess?(r.showDone?(a.done.show(),a.done.click(function(){a.statusbar.hide("slow"),a.statusbar.remove()})):a.done.hide(),r.showDelete?(a.del.show(),a.del.click(function(){r.deleteCallback&&r.deleteCallback.call(this,t,a)})):a.del.hide()):(a.statusbar.hide("slow"),a.statusbar.remove()),e.remove(),n.sCounter+=i.length},error:function(t,o,s){a.abort.hide(),"abort"==t.statusText?a.statusbar.hide("slow"):(r.onError.call(this,i,o,s),r.showStatusAfterError?(a.progressDiv.hide(),a.statusbar.append("<span style='color:red;'>ERROR: "+s+"</span>")):(a.statusbar.hide(),a.statusbar.remove())),e.remove(),n.fCounter+=i.length}};r.autoSubmit?e.ajaxSubmit(l):(r.showCancel&&(a.cancel.show(),a.cancel.click(function(){e.remove(),a.statusbar.remove()})),e.ajaxForm(l))}var f=e.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,onSelect:function(){return!0},onSubmit:function(){},onSuccess:function(){},onError:function(){},deleteCallback:!1,afterUploadAll:!1,uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed"},r);this.fileCounter=1,this.fCounter=0,this.sCounter=0,this.tCounter=0;var c="ajax-file-upload-"+(new Date).getTime();this.formGroup=c,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],t.formdata||(f.dragDrop=!1);var h=this,m=e("<div>"+e(this).html()+"</div>");e(m).addClass(f.uploadButtonClass),function b(){if(e.fn.ajaxForm){if(f.dragDrop){var t=e('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>');e(h).before(t),e(t).append(m),e(t).append(e(f.dragDropStr)),a(h,f,t)}else e(h).before(m);d(h,c,f,m)}else window.setTimeout(b,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(){e(this).is("form")&&e(this).submit()})},this.stopUpload=function(){e(".ajax-file-upload-red").each(function(){e(this).hasClass(h.formGroup)&&e(this).click()})},this.getResponses=function(){return this.responses};var v=!1;return this}}(jQuery);