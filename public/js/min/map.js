(function(e){if("object"==typeof google&&"object"==typeof google.maps){var t,s,a,o,n,i,l,r,u,n,p,c,m,g="img/",f=g+"map/markers/kot.png",d=g+"map/markers/target.png",h=[{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"},{lightness:20}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#a1cdfc"},{saturation:30},{lightness:49}]},{featureType:"road.highway",elementType:"geometry",stylers:[{hue:"#f49935"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{hue:"#fad959"}]}],v=[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#00006f"},{lightness:-5},{visibility:"on"},{weight:3},{hue:"#ff0091"}]},{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:0},{lightness:25},{gamma:.6},{hue:"#435158"}]}],y=[],b=new google.maps.LatLng(50.5,4.6),T=!1,C=[],w=new google.maps.LatLng,k=new google.maps.Circle,N=(new google.maps.Rectangle,e("#listKot")),x=(new RegExp("[,]"),new google.maps.Geocoder),M=7,O=new google.maps.Marker({icon:d}),I=google.maps.geometry.spherical,S=document.getElementById("form-city"),L=document.getElementById("form-range"),E=e("#form-city"),_=e("#form-range"),D=e(".label-range"),Z={types:["(cities)"],componentRestrictions:{country:"be"},setTypes:["geocode"]},z=!1,P=38,B=40,q=37,R=39,j=e('.mapItem input[type="submit"]'),V=e(".loading"),A=e("#filter"),G=e("#zoom"),U=e(".mapItem"),F=(e(".mapItem .tab"),e(".errorsNotifications")),K=e(".errorsNotifications .list"),Q='<li class="notSee" data-id=":id"><a href=""><div class="iconError"><img src=":icon"></img></div><span class="textError">:message</span></a></li>',W='<span class="numberTitle">:number</span> problème(s) rencontré(s)',J=e(".errorsNotifications .tab"),H=0,X="animated",Y=[{opt_textColor:"white",url:g+"map/clusters/small.png",height:30,width:30},{opt_textColor:"white",url:g+"map/clusters/medium.png",height:45,width:45},{opt_textColor:"white",url:g+"map/clusters/big.png",height:60,width:60}],$=e(".showAllMarkerKot"),et=e(".colorBlind"),tt=e(".streetView");e(function(){tt.on("click","a",kt),e("#form-range").on("change",ot),G.bind("mousewheel",nt),G.on("keydown",nt),e("html").on("click",at),et.on("click","a",lt),$.on("click","a",rt)});var st=function(){wt(),e("#locations .map").css("display","none"),Nt(new google.maps.LatLng(50.5,4.6)),U.css("display","block"),ft(),i=new google.maps.places.Autocomplete(S,Z),V.delay(400).fadeOut(function(){e(this).remove()}),ut(),google.maps.event.addListener(i,"place_changed",function(){z=!0;var s=i.getPlace();if(s.geometry){var a=s.geometry.location;if(t.panTo(a),Mt(t,14,t.getZoom()),O.setPosition(a),O.setMap(t),l=a,n=Number(L.value),!e.isNumeric(n)){var o=5,p="Distance: chiffres requis",c=g+"reseaux/fb.jpg";St(o,p,c)}r=a,console.log(s),window.setTimeout(function(){E.val(s.address_components[0].long_name)},10),T?yt(n):Lt(r,n,"latlng",function(e,t){e?(u=t,gt(j,0),_.next().hasClass("tuto")||_.next().hasClass("messageTuto")||_.after('<span class="range messageTuto">Vous pouvez régler la distance</span>')):gt(j,0)})}})},at=function(e){e.stopPropagation(),1===H&&(F.css({right:"-250px"}),H=0)},ot=function(){D.html(e(this).val()>999?"Distance: "+e(this).val()/1e3+"km":"Distance: "+e(this).val()+"m")},nt=function(e,s){var a=Number(G.attr("data-min")),o=Number(G.attr("data-max")),n=Number(G.attr("data-step"));if("mousewheel"===e.type)s>0?this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),G.css("cursor","ns-resize")):G.css("cursor","s-resize"):(this.value=parseInt(a),t.setZoom(Number(this.value)),G.css("cursor","n-resize")):parseInt(this.value)>a?(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value)),G.css("cursor","ns-resize")):G.css("cursor","n-resize");else if("keydown"===e.type)if(e.keyCode===P)this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),G.css("cursor","ns-resize")):G.css("cursor","n-resize"):(this.value=parseInt(a)+n,t.setZoom(Number(this.value)));else if(e.keyCode===B)this.value?this.value>a&&(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value))):(this.value=parseInt(a)-n,t.setZoom(Number(this.value)));else if(e.keyCode===q){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l-.1/r*2))}else if(e.keyCode===R){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l+.1/r*2))}return!1},it=function(e){styledMap=new google.maps.StyledMapType(e,{name:"Styled Map"}),t.mapTypes.set("map_style",styledMap),t.setMapTypeId("map_style")},lt=function(e){e.preventDefault(),"undefined"==typeof m&&(m=!1),m?(it(h),et.removeClass("active"),m=!1):(it(v),et.removeClass("active").addClass("active"),m=!0)},rt=function(e){if(e.preventDefault(),"undefined"==typeof c&&(c=!1),c)c=!1,$.removeClass("active"),Tt(u,n);else{p.addMarkers(y);for(var s=0;s<y.length;s++)y[s].setMap(t),y[s].setOptions({visible:!0});$.removeClass("active").addClass("active"),c=!0}},ut=function(){A.click(function(t){if(t.preventDefault(),n=Number(L.value),!e.isNumeric(n)){var s=5,a="Distance: chiffres requis",o=g+"reseaux/fb.jpg";St(s,a,o)}return r=S.value,T?yt(n):Lt(r,n,"geocoder",function(e,t){e?(u=t,gt(j,0),pt(_,"messageTuto")):gt(j,0)}),!1}),E.change(function(){if(console.log("ok"),n=Number(L.value),!e.isNumeric(n)){var t=5,s="Distance: chiffres requis",a=g+"reseaux/fb.jpg";St(t,s,a)}r=S.value,T=!1,pt(_,"messageTuto"),ct(E),T?yt(n):Lt(r,n,"geocoder",function(e,t){e?(u=t,gt(j,0),_.next().hasClass("tuto")||_.next().hasClass("messageTuto")||_.after('<span class="range messageTuto">Vous pouvez régler la distance</span>')):gt(j,0)})}),_.change(function(){if(n=Number(L.value),!e.isNumeric(n)){var t=5,s="Distance: chiffres requis",a=g+"reseaux/fb.jpg";St(t,s,a)}r=S.value,mt(""===r,e(".localite.messageError"),E,"localite",e(".mainType"),"Selectionnez une location",E),T=!1,T?yt(n):u?xt("ville",u,n):_.prop("disabled",!0)})};e.fn.extend({a_animate:function(t){"undefined"==typeof t&&(t="bounce"),this.hasClass(t)?this.removeClass(t).addClass(X).addClass(t).addClass(X).delay(1e3).queue(function(){e(this).removeClass(t).addClass(X).dequeue()}):this.removeClass(X).addClass(t).addClass(X).delay(1e3).queue(function(){e(this).removeClass(t).addClass(X).dequeue()})}});var pt=function(e,t){e.next().hasClass(t)&&e.next().remove()},ct=function(t){t.hasClass("form-error")&&(t.removeClass("form-error"),t.next().remove()),t.find(".messageError").length<=0&&e(".errors").removeClass("none").addClass("none")},mt=function(e,t,s,a,o,n,i){e&&(t.length<=0&&s.after('<span class="'+a+' messageError">Entrez une localité en premier</span>').html(n),s.addClass("form-error"))},gt=function(t,s){1===s?t.prop("disabled",!0).val("Recherche..."):0===s&&t.delay(600).queue(function(t){e(this).prop("disabled",!1).val("Filtrer"),t()})},ft=function(){e.ajax({dataType:"json",url:"getKots",type:"get",success:function(e){o=e,ht(o)}})},dt=function(e,t){return"lat"===t?e.split(",")[0]:"lng"===t?e.split(",")[1]:void 0},ht=function(e){for(var s=0;s<e.length;s++){var a=dt(e[s].latlng,"lat"),o=dt(e[s].latlng,"lng");vt(new google.maps.LatLng(a,o),e[s].id,s)}tt.css("display","block"),p=new MarkerClusterer(t,y,{gridSize:50,maxZoom:15,styles:Y})},vt=function(e,s,n){a=new google.maps.Marker({position:e,map:t,id:s,order:n,icon:f}),y.push(a),google.maps.event.addListener(a,"click",function(){Mt(t,17,t.getZoom()),console.log(o[this.order]),t.panTo(this.getPosition()),l=this.getPosition()})},yt=function(){xt("ecole",w,n)},bt=function(e,s){return{fillColor:"#fff",fillOpacity:.6,strokeColor:"#313131",strokeOpacity:.4,clickable:!1,strokeWeight:.8,map:t,center:e,radius:s}},Tt=function(e,s){C=[];var a=bt(e,s);k.setOptions(a),k.bindTo("center",O,"position"),O._cityCircle=k;for(var n=k.getBounds(),i=0;i<o.length;i++)n.contains(new google.maps.LatLng(dt(o[i].latlng,"lat"),dt(o[i].latlng,"lng")))?(C.push(o[i].id),Ct(C.length),y[i].setMap(t),y[i].setOptions({visible:!0}),t.fitBounds(n),p.redraw()):("undefined"==typeof c?(y[i].setMap(null),y[i].setOptions({visible:!1}),p.redraw()):c?(y[i].setMap(t),y[i].setOptions({visible:!0}),p.redraw()):(y[i].setMap(null),y[i].setOptions({visible:!1}),p.redraw()),p.clearMarkers(),console.log(p));N.attr("value",JSON.stringify(C))},Ct=function(e){D.html(D.html().indexOf("(")<0?D.html()+"("+e+")":D.html().replace(/\(.*?\)/g,"("+e+")"))},wt=function(e){var e=e||h,s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,minZoom:M,center:b,styles:e,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};t=new google.maps.Map(document.getElementById("gmap"),s)},kt=function(e){e.preventDefault();var t=s.getVisible();if("undefined"!=typeof l)0==t?(s.setPosition(l),s.setVisible(!0)):(s.setPosition(l),s.setVisible(!1));else{var a=6,o="Aucun endroit ciblé";St(a,o,sIcon)}},Nt=function(e){var a={position:e,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},visible:!1,panControl:!0,enableCloseButton:!1,pov:{heading:34,pitch:0}};s=new google.maps.StreetViewPanorama(document.getElementById("gmap"),a),t.setStreetView(s)},xt=function(e,s,a){k&&k.setMap(null),p=Number(a);var o=s,n=I.computeOffset(o,p,0),i=I.computeOffset(o,p,-90),l=I.computeOffset(o,p,180),r=I.computeOffset(o,p,90);if("ville"===e){O.setPosition(o),O.setMap(t);var u="#FF0000"}var u="#0000FF",p=google.maps.geometry.spherical.computeDistanceBetween(o,n),c=bt(s,p,u);k.setOptions(c);for(var m=new Array(n,i,l,r),g=new google.maps.LatLngBounds,f=0,d=m.length;d>f;f++)g.extend(m[f]);t.fitBounds(g),Tt(s,p)},Mt=function(e,t,s){if(!(s>=t)){var a=google.maps.event.addListener(e,"zoom_changed",function(){google.maps.event.removeListener(a),Mt(e,t,s+1)});setTimeout(function(){e.setZoom(s)},80)}},Ot=function(t,s){s.parent().removeClass("notSee");var a=Number(J.find(".number").html());a>0&&(J.find(".number").html(a-1),K.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ot(t,e(this))}))}))},It=function(t){t&&t.preventDefault(),0===H&&F.css({right:"-12px"}).queue(function(){H=1,e(this).dequeue()}).delay(3e3).queue(function(){F.is(":hover",":focus")?H=1:(e(this).css({right:"-250px"}).dequeue(),H=0)})},St=function(t,s,a,o){if(o)var o=o;else var o="shake";if(It(),K.find("li").attr("data-id",t).length>0){K.find("li").attr("data-id",t).removeClass("notSee").addClass("notSee");var n=Number(J.find(".number").html());J.find(".number").html(n+1),F.a_animate(o),K.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ot(t,e(this))}))})}else{var n=Number(J.find(".number").html()),i=Number(F.find(".numberTitle").html()),l=Q.replace(":message",s).replace(":icon",a).replace(":id",t),r=W.replace(":number",i+1);J.find(".number").html(n+1),F.find(".titleMessageError").html(r),K.append(l),F.a_animate(o),K.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ot(t,e(this))}))})}},Lt=function(s,a,o,n){var i=Number(a);if("geocoder"===o){gt(j,1);{({disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:x.geocode({address:s,region:"be"},function(s,a){if(a===google.maps.GeocoderStatus.OK){var o=s[0].geometry.location;"undefined"!=typeof k&&null!==k.getBounds()?t.fitBounds(k.getBounds()):Mt(t,15,t.getZoom()),t.panTo(o),l=o,e("#coords").attr("value",o);{I.computeOffset(o,i,360)}O.setPosition(o),O.setMap(t),tt.css("display","block"),google.maps.event.addListener(O,"click",function(){Mt(t,15,t.getZoom()),t.panTo(O.getPosition())}),n(!0,o)}else if(a===google.maps.GeocoderStatus.ZERO_RESULTS){var r=1,u="Nous avons trouvé aucun résultat pour votre recherche",p=g+"reseaux/fb.jpg";St(r,u,p,"shake"),n(!1,u)}else if(a===google.maps.GeocoderStatus.REQUEST_DENIED){var r=2,u="Requête refusée, changez vos termes et réessayé",p=g+"reseaux/fb.jpg";St(r,u,p),n(!1,u)}else if(a===google.maps.GeocoderStatus.INVALID_REQUEST){var r=3,u="Entrez une adresse (rue, localité)",p=g+"reseaux/fb.jpg";St(r,u,p),n(!1,u)}else if(a===google.maps.GeocoderStatus.UNKNOWN_ERROR){var r=4,u="Erreur interne, relancez votre recherche",p=g+"reseaux/fb.jpg";St(r,u,p),n(!1,u)}})})}}else"latlng"===o&&(gt(j,1),Mt(t,15,t.getZoom()),t.panTo(s),O.setPosition(s),O.setMap(t),l=s,tt.css("display","block"),google.maps.event.addListener(O,"click",function(){Mt(t,17,t.getZoom()),t.panTo(O.getPosition())}),n(!0,s))};google.maps.event.addDomListener(window,"load",st)}}).call(this,jQuery);