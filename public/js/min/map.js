(function(e){if("object"==typeof google&&"object"==typeof google.maps){var t,a,s,o,i,n,l,r,c,p,n,u,m,g,d,f="/img/",h="/images/users/:user_id/buildings/:building_id/",v="/images/users/:user_id/locations/:location_id/",y=f+"map/markers/kot.png",b=f+"map/markers/school.png",C=f+"map/markers/target.png",T=[{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"},{lightness:20}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#a1cdfc"},{saturation:30},{lightness:49}]},{featureType:"road.highway",elementType:"geometry",stylers:[{hue:"#f49935"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{hue:"#fad959"}]}],w=[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#00006f"},{lightness:-5},{visibility:"on"},{weight:3},{hue:"#ff0091"}]},{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:0},{lightness:25},{gamma:.6},{hue:"#435158"}]}],_=[],k=[],x=new google.maps.LatLng(50.5,4.6),L=!1,M=[],N=[],S=(new google.maps.LatLng,new google.maps.Circle),I=(new google.maps.Rectangle,e("#listKot")),O=(new RegExp("[,]"),new google.maps.Geocoder),j=7,E=new google.maps.Marker({icon:C}),Z=google.maps.geometry.spherical,P=document.getElementById("form-city"),B=document.getElementById("form-range"),D=e("#form-city"),q=e("#form-range"),z=e(".label-range"),R={types:["geocode"],componentRestrictions:{country:"be"},setTypes:["geocode"]},A=!1,V=38,G=40,U=37,K=39,F=e('.mapItem input[type="submit"]'),Q=e(".ListingBtn"),W=e("#slider"),J=(e("#slider-pager"),e(".typeLocationList ul")),H=e(".loading"),X=e("#filter"),Y=e("#zoom"),$=e(".mapItem"),et=(e(".mapItem .tab"),e(".errorsNotifications")),tt=e(".errorsNotifications .list"),at='<li class="notSee" data-id=":id"><a href=""><div class="iconError"><img src=":icon"></img></div><span class="textError">:message</span></a></li>',st='<span class="numberTitle">:number</span> problème(s) rencontré(s)',ot=e(".errorsNotifications .tab"),it=0,nt="animated",lt=[{opt_textColor:"white",url:f+"map/clusters/kot/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/kot/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/kot/big.png",height:60,width:60}],rt=[{opt_textColor:"white",url:f+"map/clusters/school/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/school/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/school/big.png",height:60,width:60}],ct=e(".showAllMarkerKot"),pt=e(".colorBlind"),ut=e(".streetView");e(function(){ut.on("click","a",Vt),e("#form-range").on("change",dt),Y.bind("mousewheel",ft),Y.on("keydown",ft),e("html").on("click",gt),pt.on("click","a",vt),ct.on("click","a",yt)});var mt=function(){Lt(),At(),e("#locations .map").css("display","none"),Gt(new google.maps.LatLng(50.5,4.6)),$.css("display","block"),St(),Nt(),l=new google.maps.places.Autocomplete(P,R),H.delay(400).fadeOut(function(){e(this).remove()}),bt(),google.maps.event.addListener(l,"place_changed",function(){A=!0;var a=l.getPlace();if(a.geometry){var o=a.geometry.location;if(t.panTo(o),Kt(t,14,t.getZoom()),E.setPosition(o),E.setMap(t),r=o,n=Number(B.value),!e.isNumeric(n)){var i=5,u=s.map.range_required,m=f+"reseaux/fb.jpg";Wt(i,u,m)}c=o,window.setTimeout(function(){D.val(a.address_components[0].long_name)},10),L?actionEcoleClick(n):Jt(c,n,"latlng",function(e,t){e?(p=t,Mt(F,0),q.next().hasClass("tuto")||q.next().hasClass("messageTuto")||q.after('<span class="range messageTuto">'+s.map.you_can_change_range+"</span>")):Mt(F,0)})}})},gt=function(e){e.stopPropagation(),1===it&&(et.css({right:"-250px"}),it=0)},dt=function(){z.html(e(this).val()>999?"Distance: "+e(this).val()/1e3+"km":"Distance: "+e(this).val()+"m")},ft=function(e,a){var s=Number(Y.attr("data-min")),o=Number(Y.attr("data-max")),i=Number(Y.attr("data-step"));if("mousewheel"===e.type)a>0?this.value?this.value<o?(this.value=parseInt(this.value)+i,t.setZoom(Number(this.value)),Y.css("cursor","ns-resize")):Y.css("cursor","s-resize"):(this.value=parseInt(s),t.setZoom(Number(this.value)),Y.css("cursor","n-resize")):parseInt(this.value)>s?(this.value=parseInt(this.value)-i,t.setZoom(Number(this.value)),Y.css("cursor","ns-resize")):Y.css("cursor","n-resize");else if("keydown"===e.type)if(e.keyCode===V)this.value?this.value<o?(this.value=parseInt(this.value)+i,t.setZoom(Number(this.value)),Y.css("cursor","ns-resize")):Y.css("cursor","n-resize"):(this.value=parseInt(s)+i,t.setZoom(Number(this.value)));else if(e.keyCode===G)this.value?this.value>s&&(this.value=parseInt(this.value)-i,t.setZoom(Number(this.value))):(this.value=parseInt(s)-i,t.setZoom(Number(this.value)));else if(e.keyCode===U){var n=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(n,l-.1/r*2))}else if(e.keyCode===K){var n=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(n,l+.1/r*2))}return!1},ht=function(e){styledMap=new google.maps.StyledMapType(e,{name:"Styled Map"}),t.mapTypes.set("map_style",styledMap),t.setMapTypeId("map_style")},vt=function(e){e.preventDefault(),"undefined"==typeof d&&(d=!1),d?(ht(T),pt.removeClass("active"),d=!1):(ht(w),pt.removeClass("active").addClass("active"),d=!0)},yt=function(e){if(e.preventDefault(),"undefined"==typeof g&&(g=!1),g)g=!1,ct.removeClass("active"),zt(p,n);else{for(var a=0;a<_.length;a++)_[a].setMap(t),_[a].setOptions({visible:!0});ct.removeClass("active").addClass("active"),g=!0}},bt=function(){X.click(function(t){if(t.preventDefault(),n=Number(B.value),!e.isNumeric(n)){var a=5,o=s.map.range_required,i=f+"reseaux/fb.jpg";Wt(a,o,i)}return c=P.value,L=!1,L?actionEcoleClick(n):Jt(c,n,"geocoder",function(e,t){e?(p=t,Mt(F,0),_t(q,"messageTuto")):Mt(F,0)}),!1}),D.change(Tt),q.change(Ct)},Ct=function(){if(n=Number(B.value),!e.isNumeric(n)){var t=5,a=s.map.range_required,o=f+"reseaux/fb.jpg";Wt(t,a,o)}c=P.value,L?wt(n):(xt(""===c,e(".localite.messageError"),D,"localite",e(".mainType"),s.map.select_location,D),p?Ut("ville",p,n):q.prop("disabled",!0))},Tt=function(){if(n=Number(B.value),!e.isNumeric(n)){var t=5,a=s.map.range_required,o=f+"reseaux/fb.jpg";Wt(t,a,o)}c=P.value,L=!1,_t(q,"messageTuto"),kt(D),L?actionEcoleClick(n):Jt(c,n,"geocoder",function(e,t){e?(p=t,Mt(F,0),q.next().hasClass("tuto")||q.next().hasClass("messageTuto")||q.after('<span class="range messageTuto">'+s.map.you_can_change_range+"</span>")):Mt(F,0)})},wt=function(e){Ut("ecole",r,e)};e.fn.extend({a_animate:function(t){"undefined"==typeof t&&(t="bounce"),this.hasClass(t)?this.removeClass(t).addClass(nt).addClass(t).addClass(nt).delay(1e3).queue(function(){e(this).removeClass(t).addClass(nt).dequeue()}):this.removeClass(nt).addClass(t).addClass(nt).delay(1e3).queue(function(){e(this).removeClass(t).addClass(nt).dequeue()})}});var _t=function(e,t){e.next().hasClass(t)&&e.next().remove()},kt=function(t){t.hasClass("form-error")&&(t.removeClass("form-error"),t.next().remove()),t.find(".messageError").length<=0&&e(".errors").removeClass("none").addClass("none")},xt=function(e,t,a,o,i,n,l){e&&(t.length<=0&&a.after('<span class="'+o+' messageError">'+s.map.enter_locality_or_school+"</span>").html(n),a.addClass("form-error"))},Lt=function(){e.ajax({type:"get",async:!0,url:"/getAllLang",dataType:"json",success:function(e){return s=e,!0}})},Mt=function(t,a){1===a?t.prop("disabled",!0).val(s.map.research):0===a&&t.delay(600).queue(function(t){e(this).prop("disabled",!1).val(s.map.filter),t()})},Nt=function(){e.ajax({dataType:"json",url:"/ajax/getKots",type:"get",success:function(e){i=e,Ot(i)}})},St=function(){e.ajax({dataType:"json",url:"/ajax/getSchools",type:"get",success:function(e){N=e,jt(N)}})},It=function(e,t){return"lat"===t?e.split(",")[0]:"lng"===t?e.split(",")[1]:void 0},Ot=function(e){for(var a=0;a<e.length;a++){var s=It(e[a].latlng,"lat"),o=It(e[a].latlng,"lng");Bt(new google.maps.LatLng(s,o),e[a].id,a)}ut.css("display","block"),u=new MarkerClusterer(t,_,{gridSize:50,maxZoom:15,styles:lt})},jt=function(e){for(var a=0;a<e.length;a++){var s=It(e[a].latlng,"lat"),o=It(e[a].latlng,"lng");Dt(new google.maps.LatLng(s,o),e[a].id,a)}m=new MarkerClusterer(t,k,{gridSize:100,maxZoom:15,styles:rt})},Et=function(t,a){return e.each(a,function(e,a){t=t.replace(":"+e,a)}),t},Zt=function(e,t){return e=e.split("."),e[0]+t+"."+e[1]},Pt=function(t){e.ajax({dataType:"json",url:"/ajax/getLocations/"+t,type:"get",success:function(t){W.find("li").length>0&&W.find("li").remove(),J.find("li").length>0&&J.find("li").remove(),e.each(t.photo,function(e){W.append('<li><img width="'+t.photo[e].width+'" height="'+t.photo[e].height+'" src='+Et(h,{building_id:t.id,user_id:t.user_id})+Zt(t.photo[e].url,"-mapslider")+"></li>")}),e.each(t.available_location,function(e){J.append('<li><a href="'+s.routes.locations+"/"+t.available_location[e].translation[0].value+'" class="tooltip-ui-w" title="'+s.locations.goLocation+'"><div class="type"><img classs="thumbnail" src="'+Et(v,{location_id:t.available_location[e].id,user_id:t.user_id})+Zt(t.available_location[e].accroche[0].url,"-small")+'"><span class="number" title="'+s.locations.remaining_room+'">'+t.available_location[e].remaining_room+'</span><span class="typeLocation">'+t.available_location[e].type_location.translation[0].value+'</span></div><div class="price"><span class="expensive">'+Math.round(t.available_location[e].price)+"€</span></div></a></li>")}),W.responsiveSlides({manualControls:"#slider-pager",nav:!0,pager:!0,auto:!0,prevText:s.form.previous,nextText:s.form.next,namespace:"transparent-btns"}),e(".tooltip-ui-w").tipsy(),Q.click()}})},Bt=function(e,a,s){o=new google.maps.Marker({position:e,map:t,id:a,order:s,icon:y}),_.push(o),google.maps.event.addListener(o,"click",function(){Kt(t,17,t.getZoom()),Pt(this.id),t.panTo(this.getPosition()),r=this.getPosition()})},Dt=function(e,a,s){gMarkerSchool=new google.maps.Marker({position:e,map:t,id:a,order:s,icon:b}),k.push(gMarkerSchool),google.maps.event.addListener(gMarkerSchool,"click",function(){L=!0,t.setZoom(17),t.panTo(this.getPosition()),console.log(N),console.log(this.getPosition()),console.log(this);var e=N[this.order];r=this.getPosition();var a='<div class="school"><h3 aria-level="3" role="heading" class="titleSchool">'+e.name+'</h3><span class="address">'+e.street+", "+e.locality.postal+" ("+e.locality.name+" "+e.region.translation[0].value+')</span><div class="website">'+e.web+"</div></div>",s=new google.maps.InfoWindow({content:a});s.open(t,gMarkerSchool)})},qt=function(e,a){return{fillColor:"#fff",fillOpacity:.6,strokeColor:"#313131",strokeOpacity:.4,clickable:!1,strokeWeight:.8,map:t,center:e,radius:a}},zt=function(e,a,s){if(a>1){M=[];var o=qt(e,a);S.setOptions(o),"ville"===s&&S.bindTo("center",E,"position"),E._cityCircle=S;for(var n=S.getBounds(),l=0;l<i.length;l++)n.contains(new google.maps.LatLng(It(i[l].latlng,"lat"),It(i[l].latlng,"lng")))?(M.push(i[l].id),Rt(M.length),_[l].setMap(t),_[l].setOptions({visible:!0}),t.fitBounds(n),u.redraw()):("undefined"==typeof g?(_[l].setMap(null),_[l].setOptions({visible:!1}),u.redraw()):g?(_[l].setMap(t),_[l].setOptions({visible:!0}),u.redraw()):(_[l].setMap(null),_[l].setOptions({visible:!1}),u.redraw()),u.clearMarkers());I.attr("value",JSON.stringify(M))}},Rt=function(e){z.html(z.html().indexOf("(")<0?z.html()+" ("+e+")":z.html().replace(/\(.*?\)/g," ("+e+")"))},At=function(e){var e=e||T,a={disableDefaultUI:!0,scrollwheel:!1,zoom:8,minZoom:j,center:x,styles:e,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};t=new google.maps.Map(document.getElementById("gmap"),a)},Vt=function(e){e.preventDefault();var t=a.getVisible();if("undefined"!=typeof r)0==t?(a.setPosition(r),a.setVisible(!0),ut.removeClass("active").addClass("active")):(a.setPosition(r),a.setVisible(!1),ut.removeClass("active"));else{var o=6,i=s.map.no_stop_targeted;Wt(o,i,sIcon)}},Gt=function(e){var s={position:e,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},visible:!1,panControl:!0,enableCloseButton:!1,pov:{heading:34,pitch:0}};a=new google.maps.StreetViewPanorama(document.getElementById("gmap"),s),t.setStreetView(a)},Ut=function(e,a,s){S&&S.setMap(null),p=Number(s);var o=a,i=Z.computeOffset(o,p,0),n=Z.computeOffset(o,p,-90),l=Z.computeOffset(o,p,180),r=Z.computeOffset(o,p,90);if("ville"===e){E.setPosition(o),E.setMap(t);var c="#FF0000"}var c="#0000FF",p=google.maps.geometry.spherical.computeDistanceBetween(o,i),u=qt(a,p,c);S.setOptions(u);for(var m=new Array(i,n,l,r),g=new google.maps.LatLngBounds,d=0,f=m.length;f>d;d++)g.extend(m[d]);t.fitBounds(g),zt(a,p,e)},Kt=function(e,t,a){if(!(a>=t)){var s=google.maps.event.addListener(e,"zoom_changed",function(){google.maps.event.removeListener(s),Kt(e,t,a+1)});setTimeout(function(){e.setZoom(a)},50)}},Ft=function(t,a){a.parent().removeClass("notSee");var s=Number(ot.find(".number").html());s>0&&(ot.find(".number").html(s-1),tt.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ft(t,e(this))}))}))},Qt=function(t){t&&t.preventDefault(),0===it&&et.css({right:"-12px"}).queue(function(){it=1,e(this).dequeue()}).delay(3e3).queue(function(){et.is(":hover",":focus")?it=1:(e(this).css({right:"-250px"}).dequeue(),it=0)})},Wt=function(t,a,s,o){if(o)var o=o;else var o="shake";if(Qt(),tt.find("li").attr("data-id",t).length>0){tt.find("li").attr("data-id",t).removeClass("notSee").addClass("notSee");var i=Number(ot.find(".number").html());ot.find(".number").html(i+1),et.a_animate(o),tt.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ft(t,e(this))}))})}else{var i=Number(ot.find(".number").html()),n=Number(et.find(".numberTitle").html()),l=at.replace(":message",a).replace(":icon",s).replace(":id",t),r=st.replace(":number",n+1);ot.find(".number").html(i+1),et.find(".titleMessageError").html(r),tt.append(l),et.a_animate(o),tt.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Ft(t,e(this))}))})}},Jt=function(a,o,i,n){var l=Number(o);if("geocoder"===i){Mt(F,1);{({disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:O.geocode({address:a,region:"be"},function(a,o){if(o===google.maps.GeocoderStatus.OK){var i=a[0].geometry.location;"undefined"!=typeof S&&null!==S.getBounds()?t.fitBounds(S.getBounds()):Kt(t,15,t.getZoom()),t.panTo(i),r=i,e("#coords").attr("value",i);{Z.computeOffset(i,l,360)}E.setPosition(i),E.setMap(t),ut.css("display","block"),google.maps.event.addListener(E,"click",function(){Kt(t,15,t.getZoom()),t.panTo(E.getPosition())}),n(!0,i)}else if(o===google.maps.GeocoderStatus.ZERO_RESULTS){var c=1,p=s.map.no_result_search,u=f+"reseaux/fb.jpg";Wt(c,p,u,"shake"),n(!1,p)}else if(o===google.maps.GeocoderStatus.REQUEST_DENIED){var c=2,p=s.map.request_reject,u=f+"reseaux/fb.jpg";Wt(c,p,u),n(!1,p)}else if(o===google.maps.GeocoderStatus.INVALID_REQUEST){var c=3,p=s.map.enter_address,u=f+"reseaux/fb.jpg";Wt(c,p,u),n(!1,p)}else if(o===google.maps.GeocoderStatus.UNKNOWN_ERROR){var c=4,p=s.map.intern_error,u=f+"reseaux/fb.jpg";Wt(c,p,u),n(!1,p)}})})}}else"latlng"===i&&(Mt(F,1),Kt(t,15,t.getZoom()),t.panTo(a),E.setPosition(a),E.setMap(t),r=a,ut.css("display","block"),google.maps.event.addListener(E,"click",function(){Kt(t,17,t.getZoom()),t.panTo(E.getPosition())}),n(!0,a))};google.maps.event.addDomListener(window,"load",mt)}}).call(this,jQuery);