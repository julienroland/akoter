(function(e){if("object"==typeof google&&"object"==typeof google.maps){var t,s,a,o,i,n,l,r,c,u,n,p,m,g,d,f="img/",h="/images/users/:user_id/buildings/:building_id/",v="/images/users/:user_id/locations/:location_id/",y=f+"map/markers/kot.png",b=f+"map/markers/school.png",T=f+"map/markers/target.png",w=[{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"},{lightness:20}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#a1cdfc"},{saturation:30},{lightness:49}]},{featureType:"road.highway",elementType:"geometry",stylers:[{hue:"#f49935"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{hue:"#fad959"}]}],C=[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#00006f"},{lightness:-5},{visibility:"on"},{weight:3},{hue:"#ff0091"}]},{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:0},{lightness:25},{gamma:.6},{hue:"#435158"}]}],_=[],k=[],x=new google.maps.LatLng(50.5,4.6),S=!1,L=[],M=(new google.maps.LatLng,new google.maps.Circle),N=(new google.maps.Rectangle,e("#listKot")),I=(new RegExp("[,]"),new google.maps.Geocoder),O=7,j=new google.maps.Marker({icon:T}),E=google.maps.geometry.spherical,Z=document.getElementById("form-city"),P=document.getElementById("form-range"),B=e("#form-city"),D=e("#form-range"),q=e(".label-range"),z={types:["(cities)"],componentRestrictions:{country:"be"},setTypes:["geocode"]},R=!1,A=38,V=40,G=37,U=39,K=e('.mapItem input[type="submit"]'),F=e(".ListingBtn"),Q=e("#slider"),W=(e("#slider-pager"),e(".typeLocationList ul")),J=e(".loading"),H=e("#filter"),X=e("#zoom"),Y=e(".mapItem"),$=(e(".mapItem .tab"),e(".errorsNotifications")),et=e(".errorsNotifications .list"),tt='<li class="notSee" data-id=":id"><a href=""><div class="iconError"><img src=":icon"></img></div><span class="textError">:message</span></a></li>',st='<span class="numberTitle">:number</span> problème(s) rencontré(s)',at=e(".errorsNotifications .tab"),ot=0,it="animated",nt=[{opt_textColor:"white",url:f+"map/clusters/kot/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/kot/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/kot/big.png",height:60,width:60}],lt=[{opt_textColor:"white",url:f+"map/clusters/school/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/school/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/school/big.png",height:60,width:60}],rt=e(".showAllMarkerKot"),ct=e(".colorBlind"),ut=e(".streetView");e(function(){ut.on("click","a",At),e("#form-range").on("change",gt),X.bind("mousewheel",dt),X.on("keydown",dt),e("html").on("click",mt),ct.on("click","a",ht),rt.on("click","a",vt)});var pt=function(){xt(),Rt(),e("#locations .map").css("display","none"),Vt(new google.maps.LatLng(50.5,4.6)),Y.css("display","block"),Mt(),Lt(),l=new google.maps.places.Autocomplete(Z,z),J.delay(400).fadeOut(function(){e(this).remove()}),yt(),google.maps.event.addListener(l,"place_changed",function(){R=!0;var s=l.getPlace();if(s.geometry){var o=s.geometry.location;if(t.panTo(o),Ut(t,14,t.getZoom()),j.setPosition(o),j.setMap(t),r=o,n=Number(P.value),!e.isNumeric(n)){var i=5,p=a.map.range_required,m=f+"reseaux/fb.jpg";Qt(i,p,m)}c=o,console.log(s),window.setTimeout(function(){B.val(s.address_components[0].long_name)},10),S?actionEcoleClick(n):Wt(c,n,"latlng",function(e,t){e?(u=t,St(K,0),D.next().hasClass("tuto")||D.next().hasClass("messageTuto")||D.after('<span class="range messageTuto">'+a.map.you_can_change_range+"</span>")):St(K,0)})}})},mt=function(e){e.stopPropagation(),1===ot&&($.css({right:"-250px"}),ot=0)},gt=function(){q.html(e(this).val()>999?"Distance: "+e(this).val()/1e3+"km":"Distance: "+e(this).val()+"m")},dt=function(e,s){var a=Number(X.attr("data-min")),o=Number(X.attr("data-max")),i=Number(X.attr("data-step"));if("mousewheel"===e.type)s>0?this.value?this.value<o?(this.value=parseInt(this.value)+i,t.setZoom(Number(this.value)),X.css("cursor","ns-resize")):X.css("cursor","s-resize"):(this.value=parseInt(a),t.setZoom(Number(this.value)),X.css("cursor","n-resize")):parseInt(this.value)>a?(this.value=parseInt(this.value)-i,t.setZoom(Number(this.value)),X.css("cursor","ns-resize")):X.css("cursor","n-resize");else if("keydown"===e.type)if(e.keyCode===A)this.value?this.value<o?(this.value=parseInt(this.value)+i,t.setZoom(Number(this.value)),X.css("cursor","ns-resize")):X.css("cursor","n-resize"):(this.value=parseInt(a)+i,t.setZoom(Number(this.value)));else if(e.keyCode===V)this.value?this.value>a&&(this.value=parseInt(this.value)-i,t.setZoom(Number(this.value))):(this.value=parseInt(a)-i,t.setZoom(Number(this.value)));else if(e.keyCode===G){var n=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(n,l-.1/r*2))}else if(e.keyCode===U){var n=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(n,l+.1/r*2))}return!1},ft=function(e){styledMap=new google.maps.StyledMapType(e,{name:"Styled Map"}),t.mapTypes.set("map_style",styledMap),t.setMapTypeId("map_style")},ht=function(e){e.preventDefault(),"undefined"==typeof d&&(d=!1),d?(ft(w),ct.removeClass("active"),d=!1):(ft(C),ct.removeClass("active").addClass("active"),d=!0)},vt=function(e){if(e.preventDefault(),"undefined"==typeof g&&(g=!1),g)g=!1,rt.removeClass("active"),qt(u,n);else{for(var s=0;s<_.length;s++)_[s].setMap(t),_[s].setOptions({visible:!0});rt.removeClass("active").addClass("active"),g=!0}},yt=function(){H.click(function(t){if(t.preventDefault(),n=Number(P.value),!e.isNumeric(n)){var s=5,o=a.map.range_required,i=f+"reseaux/fb.jpg";Qt(s,o,i)}return c=Z.value,S=!1,S?actionEcoleClick(n):Wt(c,n,"geocoder",function(e,t){e?(u=t,St(K,0),Ct(D,"messageTuto")):St(K,0)}),!1}),B.change(Tt),D.change(bt)},bt=function(){if(n=Number(P.value),!e.isNumeric(n)){var t=5,s=a.map.range_required,o=f+"reseaux/fb.jpg";Qt(t,s,o)}c=Z.value,S?wt(n):(kt(""===c,e(".localite.messageError"),B,"localite",e(".mainType"),a.map.select_location,B),u?Gt("ville",u,n):D.prop("disabled",!0))},Tt=function(){if(n=Number(P.value),!e.isNumeric(n)){var t=5,s=a.map.range_required,o=f+"reseaux/fb.jpg";Qt(t,s,o)}c=Z.value,S=!1,Ct(D,"messageTuto"),_t(B),S?actionEcoleClick(n):Wt(c,n,"geocoder",function(e,t){e?(u=t,St(K,0),D.next().hasClass("tuto")||D.next().hasClass("messageTuto")||D.after('<span class="range messageTuto">'+a.map.you_can_change_range+"</span>")):St(K,0)})},wt=function(e){Gt("ecole",r,e)};e.fn.extend({a_animate:function(t){"undefined"==typeof t&&(t="bounce"),this.hasClass(t)?this.removeClass(t).addClass(it).addClass(t).addClass(it).delay(1e3).queue(function(){e(this).removeClass(t).addClass(it).dequeue()}):this.removeClass(it).addClass(t).addClass(it).delay(1e3).queue(function(){e(this).removeClass(t).addClass(it).dequeue()})}});var Ct=function(e,t){e.next().hasClass(t)&&e.next().remove()},_t=function(t){t.hasClass("form-error")&&(t.removeClass("form-error"),t.next().remove()),t.find(".messageError").length<=0&&e(".errors").removeClass("none").addClass("none")},kt=function(e,t,s,o,i,n,l){e&&(t.length<=0&&s.after('<span class="'+o+' messageError">'+a.map.enter_locality_or_school+"</span>").html(n),s.addClass("form-error"))},xt=function(){e.ajax({type:"get",async:!0,url:"/getAllLang",dataType:"json",success:function(e){return a=e,console.log(e),!0}})},St=function(t,s){1===s?t.prop("disabled",!0).val(a.map.research):0===s&&t.delay(600).queue(function(t){e(this).prop("disabled",!1).val(a.map.filter),t()})},Lt=function(){e.ajax({dataType:"json",url:"ajax/getKots",type:"get",success:function(e){i=e,It(i)}})},Mt=function(){e.ajax({dataType:"json",url:"ajax/getSchools",type:"get",success:function(e){oSchools=e,Ot(oSchools)}})},Nt=function(e,t){return"lat"===t?e.split(",")[0]:"lng"===t?e.split(",")[1]:void 0},It=function(e){for(var s=0;s<e.length;s++){var a=Nt(e[s].latlng,"lat"),o=Nt(e[s].latlng,"lng");Pt(new google.maps.LatLng(a,o),e[s].id,s)}ut.css("display","block"),p=new MarkerClusterer(t,_,{gridSize:50,maxZoom:15,styles:nt})},Ot=function(e){for(var s=0;s<e.length;s++){var a=Nt(e[s].latlng,"lat"),o=Nt(e[s].latlng,"lng");Bt(new google.maps.LatLng(a,o),e[s].id,s)}m=new MarkerClusterer(t,k,{gridSize:100,maxZoom:15,styles:lt})},jt=function(t,s){return e.each(s,function(e,s){t=t.replace(":"+e,s)}),t},Et=function(e,t){return e=e.split("."),e[0]+t+"."+e[1]},Zt=function(t){e.ajax({dataType:"json",url:"ajax/getLocations/"+t,type:"get",success:function(t){console.log(t),e.each(t.photo,function(e){Q.append('<li><img width="'+t.photo[e].width+'" height="'+t.photo[e].height+'" src='+jt(h,{building_id:t.id,user_id:t.user_id})+Et(t.photo[e].url,"-gallery")+"></li>")}),e.each(t.active_location,function(e){W.append('<li><a href="'+a.routes.locations+"/"+t.active_location[e].translation[0].value+'" class="tooltip-ui-w" title="'+a.locations.goLocation+'"><div class="type"><img src="'+jt(v,{location_id:t.active_location[e].id,user_id:t.user_id})+Et(t.active_location[e].accroche[0].url,"-small")+'"><span class="number">'+t.active_location[e].remaining_location+'</span></div><div class="price"><span class="expensive">'+Math.round(t.active_location[e].price)+"€</span></div></a></li>")}),Q.responsiveSlides({manualControls:"#slider-pager",nav:!0,pager:!0,auto:!0,prevText:a.form.previous,nextText:a.form.next,namespace:"transparent-btns"}),e(".tooltip-ui-w").tipsy()}}),F.click()},Pt=function(e,s,a){o=new google.maps.Marker({position:e,map:t,id:s,order:a,icon:y}),_.push(o),google.maps.event.addListener(o,"click",function(){Ut(t,17,t.getZoom()),console.log(i[this.order]),Zt(this.id),t.panTo(this.getPosition()),r=this.getPosition()})},Bt=function(e,s,a){gMarkerSchool=new google.maps.Marker({position:e,map:t,id:s,order:a,icon:b}),k.push(gMarkerSchool),google.maps.event.addListener(gMarkerSchool,"click",function(){S=!0,t.setZoom(17),t.panTo(this.getPosition());var e=oSchools[this.id];r=this.getPosition();var s='<div class="school"><h3 aria-level="3" role="heading" class="titleSchool">'+e.name+'</h3><span class="address">'+e.street+", "+e.locality.postal+" ("+e.locality.name+" "+e.region.translation[0].value+')</span><div class="website">'+e.web+"</div></div>",a=new google.maps.InfoWindow({content:s});a.open(t,gMarkerSchool)})},Dt=function(e,s){return{fillColor:"#fff",fillOpacity:.6,strokeColor:"#313131",strokeOpacity:.4,clickable:!1,strokeWeight:.8,map:t,center:e,radius:s}},qt=function(e,s,a){if(s>1){L=[];var o=Dt(e,s);M.setOptions(o),"ville"===a&&M.bindTo("center",j,"position"),j._cityCircle=M;for(var n=M.getBounds(),l=0;l<i.length;l++)n.contains(new google.maps.LatLng(Nt(i[l].latlng,"lat"),Nt(i[l].latlng,"lng")))?(L.push(i[l].id),zt(L.length),_[l].setMap(t),_[l].setOptions({visible:!0}),t.fitBounds(n),p.redraw()):("undefined"==typeof g?(_[l].setMap(null),_[l].setOptions({visible:!1}),p.redraw()):g?(_[l].setMap(t),_[l].setOptions({visible:!0}),p.redraw()):(_[l].setMap(null),_[l].setOptions({visible:!1}),p.redraw()),p.clearMarkers());N.attr("value",JSON.stringify(L))}},zt=function(e){q.html(q.html().indexOf("(")<0?q.html()+" ("+e+")":q.html().replace(/\(.*?\)/g," ("+e+")"))},Rt=function(e){var e=e||w,s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,minZoom:O,center:x,styles:e,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};t=new google.maps.Map(document.getElementById("gmap"),s)},At=function(e){e.preventDefault();var t=s.getVisible();if("undefined"!=typeof r)0==t?(s.setPosition(r),s.setVisible(!0)):(s.setPosition(r),s.setVisible(!1));else{var o=6,i=a.map.no_stop_targeted;Qt(o,i,sIcon)}},Vt=function(e){var a={position:e,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},visible:!1,panControl:!0,enableCloseButton:!1,pov:{heading:34,pitch:0}};s=new google.maps.StreetViewPanorama(document.getElementById("gmap"),a),t.setStreetView(s)},Gt=function(e,s,a){M&&M.setMap(null),u=Number(a);var o=s,i=E.computeOffset(o,u,0),n=E.computeOffset(o,u,-90),l=E.computeOffset(o,u,180),r=E.computeOffset(o,u,90);if("ville"===e){j.setPosition(o),j.setMap(t);var c="#FF0000"}var c="#0000FF",u=google.maps.geometry.spherical.computeDistanceBetween(o,i),p=Dt(s,u,c);M.setOptions(p);for(var m=new Array(i,n,l,r),g=new google.maps.LatLngBounds,d=0,f=m.length;f>d;d++)g.extend(m[d]);t.fitBounds(g),qt(s,u,e)},Ut=function(e,t,s){if(!(s>=t)){var a=google.maps.event.addListener(e,"zoom_changed",function(){google.maps.event.removeListener(a),Ut(e,t,s+1)});setTimeout(function(){e.setZoom(s)},50)}},Kt=function(t,s){s.parent().removeClass("notSee");var a=Number(at.find(".number").html());a>0&&(at.find(".number").html(a-1),et.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Kt(t,e(this))}))}))},Ft=function(t){t&&t.preventDefault(),0===ot&&$.css({right:"-12px"}).queue(function(){ot=1,e(this).dequeue()}).delay(3e3).queue(function(){$.is(":hover",":focus")?ot=1:(e(this).css({right:"-250px"}).dequeue(),ot=0)})},Qt=function(t,s,a,o){if(o)var o=o;else var o="shake";if(Ft(),et.find("li").attr("data-id",t).length>0){et.find("li").attr("data-id",t).removeClass("notSee").addClass("notSee");var i=Number(at.find(".number").html());at.find(".number").html(i+1),$.a_animate(o),et.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Kt(t,e(this))}))})}else{var i=Number(at.find(".number").html()),n=Number($.find(".numberTitle").html()),l=tt.replace(":message",s).replace(":icon",a).replace(":id",t),r=st.replace(":number",n+1);at.find(".number").html(i+1),$.find(".titleMessageError").html(r),et.append(l),$.a_animate(o),et.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Kt(t,e(this))}))})}},Wt=function(s,o,i,n){var l=Number(o);if("geocoder"===i){St(K,1);{({disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:I.geocode({address:s,region:"be"},function(s,o){if(o===google.maps.GeocoderStatus.OK){var i=s[0].geometry.location;"undefined"!=typeof M&&null!==M.getBounds()?t.fitBounds(M.getBounds()):Ut(t,15,t.getZoom()),t.panTo(i),r=i,e("#coords").attr("value",i);{E.computeOffset(i,l,360)}j.setPosition(i),j.setMap(t),ut.css("display","block"),google.maps.event.addListener(j,"click",function(){Ut(t,15,t.getZoom()),t.panTo(j.getPosition())}),n(!0,i)}else if(o===google.maps.GeocoderStatus.ZERO_RESULTS){var c=1,u=a.map.no_result_search,p=f+"reseaux/fb.jpg";Qt(c,u,p,"shake"),n(!1,u)}else if(o===google.maps.GeocoderStatus.REQUEST_DENIED){var c=2,u=a.map.request_reject,p=f+"reseaux/fb.jpg";Qt(c,u,p),n(!1,u)}else if(o===google.maps.GeocoderStatus.INVALID_REQUEST){var c=3,u=a.map.enter_address,p=f+"reseaux/fb.jpg";Qt(c,u,p),n(!1,u)}else if(o===google.maps.GeocoderStatus.UNKNOWN_ERROR){var c=4,u=a.map.intern_error,p=f+"reseaux/fb.jpg";Qt(c,u,p),n(!1,u)}})})}}else"latlng"===i&&(St(K,1),Ut(t,15,t.getZoom()),t.panTo(s),j.setPosition(s),j.setMap(t),r=s,ut.css("display","block"),google.maps.event.addListener(j,"click",function(){Ut(t,17,t.getZoom()),t.panTo(j.getPosition())}),n(!0,s))};google.maps.event.addDomListener(window,"load",pt)}}).call(this,jQuery);