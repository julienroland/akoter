(function(e){if("object"==typeof google&&"object"==typeof google.maps){var t,s,a,o,n,i,l,r,u,p,i,c,m,g,d,f="img/",h=f+"map/markers/kot.png",v=f+"map/markers/school.png",y=f+"map/markers/target.png",b=[{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"},{lightness:20}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#a1cdfc"},{saturation:30},{lightness:49}]},{featureType:"road.highway",elementType:"geometry",stylers:[{hue:"#f49935"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{hue:"#fad959"}]}],C=[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#00006f"},{lightness:-5},{visibility:"on"},{weight:3},{hue:"#ff0091"}]},{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:0},{lightness:25},{gamma:.6},{hue:"#435158"}]}],T=[],w=[],k=new google.maps.LatLng(50.5,4.6),_=!1,x=[],M=(new google.maps.LatLng,new google.maps.Circle),N=(new google.maps.Rectangle,e("#listKot")),S=(new RegExp("[,]"),new google.maps.Geocoder),L=7,O=new google.maps.Marker({icon:y}),I=google.maps.geometry.spherical,E=document.getElementById("form-city"),Z=document.getElementById("form-range"),j=e("#form-city"),P=e("#form-range"),D=e(".label-range"),B={types:["(cities)"],componentRestrictions:{country:"be"},setTypes:["geocode"]},q=!1,z=38,R=40,A=37,V=39,G=e('.mapItem input[type="submit"]'),U=e(".loading"),K=e("#filter"),F=e("#zoom"),Q=e(".mapItem"),W=(e(".mapItem .tab"),e(".errorsNotifications")),J=e(".errorsNotifications .list"),H='<li class="notSee" data-id=":id"><a href=""><div class="iconError"><img src=":icon"></img></div><span class="textError">:message</span></a></li>',X='<span class="numberTitle">:number</span> problème(s) rencontré(s)',Y=e(".errorsNotifications .tab"),$=0,et="animated",tt=[{opt_textColor:"white",url:f+"map/clusters/kot/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/kot/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/kot/big.png",height:60,width:60}],st=[{opt_textColor:"white",url:f+"map/clusters/school/small.png",height:30,width:30},{opt_textColor:"white",url:f+"map/clusters/school/medium.png",height:45,width:45},{opt_textColor:"white",url:f+"map/clusters/school/big.png",height:60,width:60}],at=e(".showAllMarkerKot"),ot=e(".colorBlind"),nt=e(".streetView");e(function(){nt.on("click","a",It),e("#form-range").on("change",rt),F.bind("mousewheel",ut),F.on("keydown",ut),e("html").on("click",lt),ot.on("click","a",ct),at.on("click","a",mt)});var it=function(){yt(),Ot(),e("#locations .map").css("display","none"),Et(new google.maps.LatLng(50.5,4.6)),Q.css("display","block"),Tt(),Ct(),l=new google.maps.places.Autocomplete(E,B),U.delay(400).fadeOut(function(){e(this).remove()}),gt(),google.maps.event.addListener(l,"place_changed",function(){q=!0;var s=l.getPlace();if(s.geometry){var o=s.geometry.location;if(t.panTo(o),jt(t,14,t.getZoom()),O.setPosition(o),O.setMap(t),r=o,i=Number(Z.value),!e.isNumeric(i)){var n=5,c=a.map.range_required,m=f+"reseaux/fb.jpg";Bt(n,c,m)}u=o,console.log(s),window.setTimeout(function(){j.val(s.address_components[0].long_name)},10),_?actionEcoleClick(i):qt(u,i,"latlng",function(e,t){e?(p=t,bt(G,0),P.next().hasClass("tuto")||P.next().hasClass("messageTuto")||P.after('<span class="range messageTuto">'+a.map.you_can_change_range+"</span>")):bt(G,0)})}})},lt=function(e){e.stopPropagation(),1===$&&(W.css({right:"-250px"}),$=0)},rt=function(){D.html(e(this).val()>999?"Distance: "+e(this).val()/1e3+"km":"Distance: "+e(this).val()+"m")},ut=function(e,s){var a=Number(F.attr("data-min")),o=Number(F.attr("data-max")),n=Number(F.attr("data-step"));if("mousewheel"===e.type)s>0?this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),F.css("cursor","ns-resize")):F.css("cursor","s-resize"):(this.value=parseInt(a),t.setZoom(Number(this.value)),F.css("cursor","n-resize")):parseInt(this.value)>a?(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value)),F.css("cursor","ns-resize")):F.css("cursor","n-resize");else if("keydown"===e.type)if(e.keyCode===z)this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),F.css("cursor","ns-resize")):F.css("cursor","n-resize"):(this.value=parseInt(a)+n,t.setZoom(Number(this.value)));else if(e.keyCode===R)this.value?this.value>a&&(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value))):(this.value=parseInt(a)-n,t.setZoom(Number(this.value)));else if(e.keyCode===A){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l-.1/r*2))}else if(e.keyCode===V){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l+.1/r*2))}return!1},pt=function(e){styledMap=new google.maps.StyledMapType(e,{name:"Styled Map"}),t.mapTypes.set("map_style",styledMap),t.setMapTypeId("map_style")},ct=function(e){e.preventDefault(),"undefined"==typeof d&&(d=!1),d?(pt(b),ot.removeClass("active"),d=!1):(pt(C),ot.removeClass("active").addClass("active"),d=!0)},mt=function(e){if(e.preventDefault(),"undefined"==typeof g&&(g=!1),g)g=!1,at.removeClass("active"),St(p,i);else{c.addMarkers(T);for(var s=0;s<T.length;s++)T[s].setMap(t),T[s].setOptions({visible:!0});at.removeClass("active").addClass("active"),g=!0}},gt=function(){K.click(function(t){if(t.preventDefault(),i=Number(Z.value),!e.isNumeric(i)){var s=5,o=a.map.range_required,n=f+"reseaux/fb.jpg";Bt(s,o,n)}return u=E.value,_=!1,_?actionEcoleClick(i):qt(u,i,"geocoder",function(e,t){e?(p=t,bt(G,0),ft(P,"messageTuto")):bt(G,0)}),!1}),j.change(function(){if(console.log("ok"),i=Number(Z.value),!e.isNumeric(i)){var t=5,s=a.map.range_required,o=f+"reseaux/fb.jpg";Bt(t,s,o)}u=E.value,_=!1,ft(P,"messageTuto"),ht(j),_?actionEcoleClick(i):qt(u,i,"geocoder",function(e,t){e?(p=t,bt(G,0),P.next().hasClass("tuto")||P.next().hasClass("messageTuto")||P.after('<span class="range messageTuto">'+a.map.you_can_change_range+"</span>")):bt(G,0)})}),P.change(function(){if(i=Number(Z.value),!e.isNumeric(i)){var t=5,s=a.map.range_required,o=f+"reseaux/fb.jpg";Bt(t,s,o)}u=E.value,_?dt(i):(vt(""===u,e(".localite.messageError"),j,"localite",e(".mainType"),a.map.select_location,j),p?Zt("ville",p,i):P.prop("disabled",!0))})},dt=function(e){Zt("ecole",r,e)};e.fn.extend({a_animate:function(t){"undefined"==typeof t&&(t="bounce"),this.hasClass(t)?this.removeClass(t).addClass(et).addClass(t).addClass(et).delay(1e3).queue(function(){e(this).removeClass(t).addClass(et).dequeue()}):this.removeClass(et).addClass(t).addClass(et).delay(1e3).queue(function(){e(this).removeClass(t).addClass(et).dequeue()})}});var ft=function(e,t){e.next().hasClass(t)&&e.next().remove()},ht=function(t){t.hasClass("form-error")&&(t.removeClass("form-error"),t.next().remove()),t.find(".messageError").length<=0&&e(".errors").removeClass("none").addClass("none")},vt=function(e,t,s,o,n,i,l){e&&(t.length<=0&&s.after('<span class="'+o+' messageError">'+a.map.enter_locality_or_school+"</span>").html(i),s.addClass("form-error"))},yt=function(){e.ajax({type:"get",async:!0,url:"/getAllLang",dataType:"json",success:function(e){return a=e,console.log(e),!0}})},bt=function(t,s){1===s?t.prop("disabled",!0).val(a.map.research):0===s&&t.delay(600).queue(function(t){e(this).prop("disabled",!1).val(a.map.filter),t()})},Ct=function(){e.ajax({dataType:"json",url:"getKots",type:"get",success:function(e){n=e,kt(n)}})},Tt=function(){e.ajax({dataType:"json",url:"getSchools",type:"get",success:function(e){oSchools=e,_t(oSchools)}})},wt=function(e,t){return"lat"===t?e.split(",")[0]:"lng"===t?e.split(",")[1]:void 0},kt=function(e){for(var s=0;s<e.length;s++){var a=wt(e[s].latlng,"lat"),o=wt(e[s].latlng,"lng");xt(new google.maps.LatLng(a,o),e[s].id,s)}nt.css("display","block"),c=new MarkerClusterer(t,T,{gridSize:50,maxZoom:15,styles:tt})},_t=function(e){for(var s=0;s<e.length;s++){var a=wt(e[s].latlng,"lat"),o=wt(e[s].latlng,"lng");Mt(new google.maps.LatLng(a,o),e[s].id,s)}m=new MarkerClusterer(t,w,{gridSize:100,maxZoom:15,styles:st})},xt=function(e,s,a){o=new google.maps.Marker({position:e,map:t,id:s,order:a,icon:h}),T.push(o),google.maps.event.addListener(o,"click",function(){jt(t,17,t.getZoom()),console.log(n[this.order]),t.panTo(this.getPosition()),r=this.getPosition()})},Mt=function(e,s,a){gMarkerSchool=new google.maps.Marker({position:e,map:t,id:s,order:a,icon:v}),w.push(gMarkerSchool),google.maps.event.addListener(gMarkerSchool,"click",function(){_=!0,jt(t,17,t.getZoom()),t.panTo(this.getPosition()),r=this.getPosition()})},Nt=function(e,s){return{fillColor:"#fff",fillOpacity:.6,strokeColor:"#313131",strokeOpacity:.4,clickable:!1,strokeWeight:.8,map:t,center:e,radius:s}},St=function(e,s,a){console.log(e),x=[];var o=Nt(e,s);M.setOptions(o),"ville"===a&&M.bindTo("center",O,"position"),O._cityCircle=M;for(var i=M.getBounds(),l=0;l<n.length;l++)i.contains(new google.maps.LatLng(wt(n[l].latlng,"lat"),wt(n[l].latlng,"lng")))?(x.push(n[l].id),Lt(x.length),T[l].setMap(t),T[l].setOptions({visible:!0}),t.fitBounds(i),c.redraw()):("undefined"==typeof g?(T[l].setMap(null),T[l].setOptions({visible:!1}),c.redraw()):g?(T[l].setMap(t),T[l].setOptions({visible:!0}),c.redraw()):(T[l].setMap(null),T[l].setOptions({visible:!1}),c.redraw()),c.clearMarkers());N.attr("value",JSON.stringify(x))},Lt=function(e){D.html(D.html().indexOf("(")<0?D.html()+" ("+e+")":D.html().replace(/\(.*?\)/g," ("+e+")"))},Ot=function(e){var e=e||b,s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,minZoom:L,center:k,styles:e,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};t=new google.maps.Map(document.getElementById("gmap"),s)},It=function(e){e.preventDefault();var t=s.getVisible();if("undefined"!=typeof r)0==t?(s.setPosition(r),s.setVisible(!0)):(s.setPosition(r),s.setVisible(!1));else{var o=6,n=a.map.no_stop_targeted;Bt(o,n,sIcon)}},Et=function(e){var a={position:e,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},visible:!1,panControl:!0,enableCloseButton:!1,pov:{heading:34,pitch:0}};s=new google.maps.StreetViewPanorama(document.getElementById("gmap"),a),t.setStreetView(s)},Zt=function(e,s,a){M&&M.setMap(null),p=Number(a);var o=s,n=I.computeOffset(o,p,0),i=I.computeOffset(o,p,-90),l=I.computeOffset(o,p,180),r=I.computeOffset(o,p,90);if("ville"===e){O.setPosition(o),O.setMap(t);var u="#FF0000"}var u="#0000FF",p=google.maps.geometry.spherical.computeDistanceBetween(o,n),c=Nt(s,p,u);M.setOptions(c);for(var m=new Array(n,i,l,r),g=new google.maps.LatLngBounds,d=0,f=m.length;f>d;d++)g.extend(m[d]);t.fitBounds(g),St(s,p,e)},jt=function(e,t,s){if(!(s>=t)){var a=google.maps.event.addListener(e,"zoom_changed",function(){google.maps.event.removeListener(a),jt(e,t,s+1)});setTimeout(function(){e.setZoom(s)},80)}},Pt=function(t,s){s.parent().removeClass("notSee");var a=Number(Y.find(".number").html());a>0&&(Y.find(".number").html(a-1),J.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Pt(t,e(this))}))}))},Dt=function(t){t&&t.preventDefault(),0===$&&W.css({right:"-12px"}).queue(function(){$=1,e(this).dequeue()}).delay(3e3).queue(function(){W.is(":hover",":focus")?$=1:(e(this).css({right:"-250px"}).dequeue(),$=0)})},Bt=function(t,s,a,o){if(o)var o=o;else var o="shake";if(Dt(),J.find("li").attr("data-id",t).length>0){J.find("li").attr("data-id",t).removeClass("notSee").addClass("notSee");var n=Number(Y.find(".number").html());Y.find(".number").html(n+1),W.a_animate(o),J.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Pt(t,e(this))}))})}else{var n=Number(Y.find(".number").html()),i=Number(W.find(".numberTitle").html()),l=H.replace(":message",s).replace(":icon",a).replace(":id",t),r=X.replace(":number",i+1);Y.find(".number").html(n+1),W.find(".titleMessageError").html(r),J.append(l),W.a_animate(o),J.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Pt(t,e(this))}))})}},qt=function(s,o,n,i){var l=Number(o);if("geocoder"===n){bt(G,1);{({disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:S.geocode({address:s,region:"be"},function(s,o){if(o===google.maps.GeocoderStatus.OK){var n=s[0].geometry.location;"undefined"!=typeof M&&null!==M.getBounds()?t.fitBounds(M.getBounds()):jt(t,15,t.getZoom()),t.panTo(n),r=n,e("#coords").attr("value",n);{I.computeOffset(n,l,360)}O.setPosition(n),O.setMap(t),nt.css("display","block"),google.maps.event.addListener(O,"click",function(){jt(t,15,t.getZoom()),t.panTo(O.getPosition())}),i(!0,n)}else if(o===google.maps.GeocoderStatus.ZERO_RESULTS){var u=1,p=a.map.no_result_search,c=f+"reseaux/fb.jpg";Bt(u,p,c,"shake"),i(!1,p)}else if(o===google.maps.GeocoderStatus.REQUEST_DENIED){var u=2,p=a.map.request_reject,c=f+"reseaux/fb.jpg";Bt(u,p,c),i(!1,p)}else if(o===google.maps.GeocoderStatus.INVALID_REQUEST){var u=3,p=a.map.enter_address,c=f+"reseaux/fb.jpg";Bt(u,p,c),i(!1,p)}else if(o===google.maps.GeocoderStatus.UNKNOWN_ERROR){var u=4,p=a.map.intern_error,c=f+"reseaux/fb.jpg";Bt(u,p,c),i(!1,p)}})})}}else"latlng"===n&&(bt(G,1),jt(t,15,t.getZoom()),t.panTo(s),O.setPosition(s),O.setMap(t),r=s,nt.css("display","block"),google.maps.event.addListener(O,"click",function(){jt(t,17,t.getZoom()),t.panTo(O.getPosition())}),i(!0,s))};google.maps.event.addDomListener(window,"load",it)}}).call(this,jQuery);