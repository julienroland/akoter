(function(e){if("object"==typeof google&&"object"==typeof google.maps){var t,s="img/",a=s+"map/markers/kot.png",o=s+"map/markers/school.png",n=s+"map/markers/target.png",i,l=[{featureType:"road",elementType:"labels",stylers:[{visibility:"simplified"},{lightness:20}]},{featureType:"administrative.land_parcel",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"road.local",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road.highway",elementType:"labels",stylers:[{visibility:"simplified"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{hue:"#a1cdfc"},{saturation:30},{lightness:49}]},{featureType:"road.highway",elementType:"geometry",stylers:[{hue:"#f49935"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{hue:"#fad959"}]}],r=[{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{color:"#00006f"},{lightness:-5},{visibility:"on"},{weight:3},{hue:"#ff0091"}]},{featureType:"all",elementType:"all",stylers:[{invert_lightness:!0},{saturation:0},{lightness:25},{gamma:.6},{hue:"#435158"}]}],u=[],p=[],g,m,c=new google.maps.LatLng(50.5,4.6),f,d,h,v=!1,y=[],b=[],T=new google.maps.LatLng,w=[],C,k=new google.maps.Circle,L=new google.maps.Rectangle,N=[],x=e("#listKot"),E=[],I=new RegExp("[,]"),M=new google.maps.Geocoder,O,S=7,_=new google.maps.Marker({icon:n}),D=google.maps.geometry.spherical,P=document.getElementById("form-city"),Z=document.getElementById("form-range"),z=e("#form-city"),B=e("#form-range"),j=e(".label-range"),q={types:["(cities)"],componentRestrictions:{country:"be"},setTypes:["geocode"]},R,V=!1,A,G=38,U=40,F=37,K=39,Q=e('.mapItem input[type="submit"]'),W,J,H,d,X=e(".loading"),Y=e("#filter"),$=e("#zoom"),et=e(".mapItem"),tt=e(".mapItem .tab"),st,at=e(".errorsNotifications"),ot=e(".errorsNotifications .list"),nt='<li class="notSee" data-id=":id"><a href=""><div class="iconError"><img src=":icon"></img></div><span class="textError">:message</span></a></li>',it='<span class="numberTitle">:number</span> problème(s) rencontré(s)',lt=e(".errorsNotifications .tab"),rt=0,ut="animated",pt=[{opt_textColor:"white",url:s+"map/clusters/small.png",height:30,width:30},{opt_textColor:"white",url:s+"map/clusters/medium.png",height:45,width:45},{opt_textColor:"white",url:s+"map/clusters/big.png",height:60,width:60}],gt=e(".showAllMarkerKot"),mt,ct=e(".colorBlind"),ft=e(".streetView"),dt,ht;e(function(){ft.on("click","a",Ft),e("#form-range").on("change",bt),$.bind("mousewheel",Tt),$.on("keydown",Tt),e("html").on("click",yt),ct.on("click","a",Ct),gt.on("click","a",Lt)});var vt=function(){Ut(),e("#locations .map").css("display","none"),Kt(new google.maps.LatLng(50.5,4.6)),et.css("display","block"),St(),R=new google.maps.places.Autocomplete(P,q),X.delay(400).fadeOut(function(){e(this).remove()}),Nt(),google.maps.event.addListener(R,"place_changed",function(){V=!0;var a=R.getPlace();if(a.geometry){var o=a.geometry.location;if(t.panTo(o),Wt(t,17,t.getZoom()),_.setPosition(o),_.setMap(t),A=o,d=Number(Z.value),!e.isNumeric(d)){var n=5,i="Distance: chiffres requis",l=s+"reseaux/fb.jpg";Xt(n,i,l)}J=o,console.log(a),window.setTimeout(function(){z.val(a.address_components[0].long_name)},10),v?jt(d):Yt(J,d,"latlng",function(e,t){e?(H=t,Ot(Q,0),B.next().hasClass("tuto")||B.next().hasClass("messageTuto")||B.after('<span class="range messageTuto">Vous pouvez régler la distance</span>')):Ot(Q,0)})}})},yt=function(e){e.stopPropagation(),1===rt&&(at.css({right:"-250px"}),rt=0)},bt=function(){j.html(e(this).val()>999?"Distance: "+e(this).val()/1e3+"km":"Distance: "+e(this).val()+"m")},Tt=function(e,s){var a=Number($.attr("data-min")),o=Number($.attr("data-max")),n=Number($.attr("data-step"));if("mousewheel"===e.type)s>0?this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),$.css("cursor","ns-resize")):$.css("cursor","s-resize"):(this.value=parseInt(a),t.setZoom(Number(this.value)),$.css("cursor","n-resize")):parseInt(this.value)>a?(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value)),$.css("cursor","ns-resize")):$.css("cursor","n-resize");else if("keydown"===e.type)if(e.keyCode===G)this.value?this.value<o?(this.value=parseInt(this.value)+n,t.setZoom(Number(this.value)),$.css("cursor","ns-resize")):$.css("cursor","n-resize"):(this.value=parseInt(a)+n,t.setZoom(Number(this.value)));else if(e.keyCode===U)this.value?this.value>a&&(this.value=parseInt(this.value)-n,t.setZoom(Number(this.value))):(this.value=parseInt(a)-n,t.setZoom(Number(this.value)));else if(e.keyCode===F){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l-.1/r*2))}else if(e.keyCode===K){var i=t.getCenter().lat(),l=t.getCenter().lng(),r=t.getZoom();t.panTo(new google.maps.LatLng(i,l+.1/r*2))}return!1},wt=function(e){styledMap=new google.maps.StyledMapType(e,{name:"Styled Map"}),t.mapTypes.set("map_style",styledMap),t.setMapTypeId("map_style")},Ct=function(e){e.preventDefault(),"undefined"==typeof ht&&(ht=!1),ht?(wt(l),ct.removeClass("active"),ht=!1):(wt(r),ct.removeClass("active").addClass("active"),ht=!0)},kt=function(e){var s=new google.maps.LatLngBounds;for(var a in e){if(marker[a].getVisible()===!0&&null!==marker[a].getMap())var o=e[a].getPosition();s.extend(o)}if(s.getNorthEast().equals(s.getSouthWest())){var n=new google.maps.LatLng(s.getNorthEast().lat()+.1,s.getNorthEast().lng()+.1),i=new google.maps.LatLng(s.getNorthEast().lat()-.1,s.getNorthEast().lng()-.1);s.extend(n),s.extend(i)}t.fitBounds(s)},Lt=function(e){if(e.preventDefault(),"undefined"==typeof mt&&(mt=!1),mt)mt=!1,gt.removeClass("active"),Rt(H,d);else{for(var s=0;s<u.length;s++)u[s].setMap(t),u[s].setOptions({visible:!0});gt.removeClass("active").addClass("active"),mt=!0}},Nt=function(){Y.click(function(t){if(t.preventDefault(),d=Number(Z.value),!e.isNumeric(d)){var a=5,o="Distance: chiffres requis",n=s+"reseaux/fb.jpg";Xt(a,o,n)}return J=P.value,v?jt(d):Yt(J,d,"geocoder",function(e,t){e?(H=t,Ot(Q,0),xt(B,"messageTuto")):Ot(Q,0)}),!1}),z.change(function(){if(console.log("ok"),d=Number(Z.value),!e.isNumeric(d)){var t=5,a="Distance: chiffres requis",o=s+"reseaux/fb.jpg";Xt(t,a,o)}J=P.value,v=!1,xt(B,"messageTuto"),Et(z),v?jt(d):Yt(J,d,"geocoder",function(e,t){e?(H=t,Ot(Q,0),B.next().hasClass("tuto")||B.next().hasClass("messageTuto")||B.after('<span class="range messageTuto">Vous pouvez régler la distance</span>')):Ot(Q,0)})}),B.change(function(){if(d=Number(Z.value),!e.isNumeric(d)){var t=5,a="Distance: chiffres requis",o=s+"reseaux/fb.jpg";Xt(t,a,o)}J=P.value,""===J&&gt.css("display","block"),It(""===J,e(".localite.messageError"),z,"localite",e(".mainType"),"Selectionnez une location",z),v=!1,v?jt(d):H?Qt("ville",H,d):B.prop("disabled",!0)})};e.fn.extend({a_animate:function(t){"undefined"==typeof t&&(t="bounce"),this.hasClass(t)?this.removeClass(t).addClass(ut).addClass(t).addClass(ut).delay(1e3).queue(function(){e(this).removeClass(t).addClass(ut).dequeue()}):this.removeClass(ut).addClass(t).addClass(ut).delay(1e3).queue(function(){e(this).removeClass(t).addClass(ut).dequeue()})}});var xt=function(e,t){e.next().hasClass(t)&&e.next().remove()},Et=function(t){t.hasClass("form-error")&&(t.removeClass("form-error"),t.next().remove()),t.find(".messageError").length<=0&&e(".errors").removeClass("none").addClass("none")},It=function(e,t,s,a,o,n,i){e&&(t.length<=0&&s.after('<span class="'+a+' messageError">Entrez une localité en premier</span>').html(n),s.addClass("form-error"))},Mt=function(e){e.length>0&&e.hasClass("none")&&(e.removeClass("none"),e.find("span").length<=0&&e.append("<span>erreur(s) détectée(s)</span>"))},Ot=function(t,s){1===s?t.prop("disabled",!0).val("Recherche..."):0===s&&t.delay(600).queue(function(t){e(this).prop("disabled",!1).val("Filtrer"),t()})},St=function(){e.ajax({dataType:"json",url:"getKots",type:"get",success:function(e){f=e,Pt(f)}})},_t=function(){e.ajax({dataType:"json",url:"dataEcole",type:"get",success:function(e){h=e.data,Zt(h)}})},Dt=function(e,t){return"lat"===t?e.split(",")[0]:"lng"===t?e.split(",")[1]:void 0},Pt=function(e){console.log(e.length);for(var s=0;s<e.length;s++){var a=Dt(e[s].latlng,"lat"),o=Dt(e[s].latlng,"lng");zt(new google.maps.LatLng(a,o),e[s].id,s)}ft.css("display","block"),st=new MarkerClusterer(t,u,{gridSize:50,maxZoom:15,styles:pt})},Zt=function(e){for(var t=new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png"),s=0;s<=e.length-1;s++){var a=e[s].lat,o=e[s].lng,n=[a,o];E.push(n),Bt(Number(E[s][0]),Number(E[s][1]),e[s].nom,t)}},zt=function(e,s,o){g=new google.maps.Marker({position:e,map:t,id:s,order:o,icon:a}),u.push(g),google.maps.event.addListener(g,"click",function(){Wt(t,17,t.getZoom()),console.log(f[this.order]),t.panTo(this.getPosition()),A=this.getPosition()})},Bt=function(s,a,o,n){var i=new google.maps.LatLng(s,a);m=new google.maps.Marker({position:i,map:t,animation:google.maps.Animation.DROP,title:o,icon:n}),p.push(m),google.maps.event.addListener(m,"click",function(s){v=!0,console.log(v),w=[],Wt(t,17,t.getZoom()),t.panTo(m.getPosition()),A=m.getPosition();for(var a=0;a<=h.length-1;a++)w={latlng:new google.maps.LatLng(h[a].lat,h[a].lng),nom:h[a].nom},b.push(w);for(var a=0;a<=b.length-1;a++)s.latLng.lat()===b[a].latlng.lat()&&s.latLng.lng()===b[a].latlng.lng()&&(e("#map").attr("value",b[a].nom),T=new google.maps.LatLng(b[a].latlng.lat(),b[a].latlng.lng()))})},jt=function(e){Qt("ecole",T,d)},qt=function(e,s,a){return{fillColor:"#fff",fillOpacity:.6,strokeColor:"#313131",strokeOpacity:.4,clickable:!1,strokeWeight:.8,map:t,center:e,radius:s}},Rt=function(e,s){y=[];var a=qt(e,s);k.setOptions(a),k.bindTo("center",_,"position"),_._cityCircle=k;for(var o=k.getBounds(),n=0;n<f.length;n++)o.contains(new google.maps.LatLng(f[n].lat,f[n].lng))?(y.push(f[n].id),Vt(y.length),u[n].setMap(t),u[n].setOptions({visible:!0}),t.fitBounds(o),st.redraw()):"undefined"==typeof mt?(u[n].setMap(null),u[n].setOptions({visible:!1}),st.redraw()):mt?(u[n].setMap(t),u[n].setOptions({visible:!0}),st.redraw()):(u[n].setMap(null),u[n].setOptions({visible:!1}),st.redraw());y.length<=0&&gt.css("display","block").a_animate(),x.attr("value",JSON.stringify(y))},Vt=function(e){j.html(j.html().indexOf("(")<0?j.html()+"("+e+")":j.html().replace(/\(.*?\)/g,"("+e+")"))},At=function(){e("#gmap").css({display:"none"}),e(".mapInfo").css({height:"auto",marginLeft:0,"float":"none"})},Gt=function(){e("#gmap").css({display:"block"}),e(".mapInfo").css({height:"auto",marginLeft:0,"float":"left"})},Ut=function(e){var e=e||l,s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,minZoom:S,center:c,styles:e,streetViewControl:!1,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP,"map_style"]}};t=new google.maps.Map(document.getElementById("gmap"),s)},Ft=function(e){e.preventDefault();var t=i.getVisible();if("undefined"!=typeof A)0==t?(i.setPosition(A),i.setVisible(!0)):(i.setPosition(A),i.setVisible(!1));else{var s=6,a="Aucun endroit ciblé";Xt(s,a,sIcon)}},Kt=function(e){var s={position:e,addressControlOptions:{position:google.maps.ControlPosition.BOTTOM},visible:!1,panControl:!0,enableCloseButton:!1,pov:{heading:34,pitch:0}};i=new google.maps.StreetViewPanorama(document.getElementById("gmap"),s),t.setStreetView(i)},Qt=function(e,s,a){k&&k.setMap(null),p=Number(a);var o=s,n=D.computeOffset(o,p,0),i=D.computeOffset(o,p,-90),l=D.computeOffset(o,p,180),r=D.computeOffset(o,p,90);if("ville"===e){_.setPosition(o),_.setMap(t);var u="#FF0000"}var u="#0000FF",p=google.maps.geometry.spherical.computeDistanceBetween(o,n),g=qt(s,p,u);k.setOptions(g);for(var m=new Array(n,i,l,r),c=new google.maps.LatLngBounds,f=0,d=m.length;d>f;f++)c.extend(m[f]);t.fitBounds(c),Rt(s,p)},Wt=function(e,t,s){if(!(s>=t)){var a=google.maps.event.addListener(e,"zoom_changed",function(o){google.maps.event.removeListener(a),Wt(e,t,s+1)});setTimeout(function(){e.setZoom(s)},80)}},Jt=function(t,s){s.parent().removeClass("notSee");var a=Number(lt.find(".number").html());a>0&&(lt.find(".number").html(a-1),ot.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Jt(t,e(this))}))}))},Ht=function(t){t&&t.preventDefault(),0===rt&&at.css({right:"-12px"}).queue(function(){rt=1,e(this).dequeue()}).delay(3e3).queue(function(){at.is(":hover",":focus")?rt=1:(e(this).css({right:"-250px"}).dequeue(),rt=0)})},Xt=function(t,s,a,o){if(o)var o=o;else var o="shake";if(Ht(),ot.find("li").attr("data-id",t).length>0){ot.find("li").attr("data-id",t).removeClass("notSee").addClass("notSee");var n=Number(lt.find(".number").html());lt.find(".number").html(n+1),at.a_animate(o),ot.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Jt(t,e(this))}))})}else{var n=Number(lt.find(".number").html()),i=Number(at.find(".numberTitle").html()),l=nt.replace(":message",s).replace(":icon",a).replace(":id",t),r=it.replace(":number",i+1);lt.find(".number").html(n+1),at.find(".titleMessageError").html(r),ot.append(l),at.a_animate(o),ot.find("li a").each(function(){e(this).parent().hasClass("notSee")&&(e(this).parent().hasClass("notSee"),e(this).mouseover(function(t){Jt(t,e(this))}))})}},Yt=function(a,o,n,i){var l=Number(o);if("geocoder"===n){Ot(Q,1);var r={disableDefaultUI:!0,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,center:M.geocode({address:a,region:"be"},function(a,o){if(o===google.maps.GeocoderStatus.OK){var n=a[0].geometry.location;"undefined"!=typeof k&&null!==k.getBounds()?t.fitBounds(k.getBounds()):Wt(t,15,t.getZoom()),t.panTo(n),A=n,e("#coords").attr("value",n);var r=D.computeOffset(n,l,360);_.setPosition(n),_.setMap(t),ft.css("display","block"),google.maps.event.addListener(_,"click",function(){Wt(t,17,t.getZoom()),t.panTo(_.getPosition())}),i(!0,n)}else if(o===google.maps.GeocoderStatus.ZERO_RESULTS){var u=1,p="Nous avons trouvé aucun résultat pour votre recherche",g=s+"reseaux/fb.jpg";Xt(u,p,g,"shake"),i(!1,p)}else if(o===google.maps.GeocoderStatus.REQUEST_DENIED){var u=2,p="Requête refusée, changez vos termes et réessayé",g=s+"reseaux/fb.jpg";Xt(u,p,g),i(!1,p)}else if(o===google.maps.GeocoderStatus.INVALID_REQUEST){var u=3,p="Entrez une adresse (rue, localité)",g=s+"reseaux/fb.jpg";Xt(u,p,g),i(!1,p)}else if(o===google.maps.GeocoderStatus.UNKNOWN_ERROR){var u=4,p="Erreur interne, relancez votre recherche",g=s+"reseaux/fb.jpg";Xt(u,p,g),i(!1,p)}})}}else"latlng"===n&&(Ot(Q,1),Wt(t,15,t.getZoom()),t.panTo(a),_.setPosition(a),_.setMap(t),A=a,ft.css("display","block"),google.maps.event.addListener(_,"click",function(){Wt(t,17,t.getZoom()),t.panTo(_.getPosition())}),i(!0,a))};google.maps.event.addDomListener(window,"load",vt)}}).call(this,jQuery);